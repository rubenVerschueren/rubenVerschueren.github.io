<!-- build time:Wed Oct 19 2016 11:47:17 GMT+0200 (Romance Daylight Time) --><!DOCTYPE HTML><html><head><meta charset="utf-8"><title>Page 5 | Sitecorn</title><meta name="author" content="Ruben Verschueren"><meta name="description" content="web development tips &amp; tricks"><meta name="og:description" content="web development tips &amp; tricks"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta property="og:site_name" content="Sitecorn"><meta property="og:url" content="http://www.sitecorn.be/page/5/index.html"><meta property="og:image" content="http://www.sitecorn.be/images/sitecorn_large.png"><meta property="og:image:width" content="100"><meta property="og:image:height" content="121"><link rel="icon" type="image/png" href="http://www.sitecorn.be/images/fav.ico"><link href="http://www.sitecorn.be/images/sitecorn_large.png" rel="icon"><link rel="alternate" href="/atom.xml" title="Sitecorn" type="application/atom+xml"><link rel="stylesheet" href="/css/style.css" media="screen" type="text/css"><link rel="stylesheet" href="/css/custom.css" media="screen" type="text/css"><script>!function(e,a,t,n,c,o,s){e.GoogleAnalyticsObject=c,e[c]=e[c]||function(){(e[c].q=e[c].q||[]).push(arguments)},e[c].l=1*new Date,o=a.createElement(t),s=a.getElementsByTagName(t)[0],o.async=1,o.src=n,s.parentNode.insertBefore(o,s)}(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create","UA-76954315-1","auto"),ga("send","pageview")</script></head></html><body><header id="header" class="inner"><div class="alignleft"><h1><a href="/">Sitecorn</a></h1><h2><a href="/">offering a few kernels of knowledge</a></h2></div><nav id="main-nav" class="alignright"><ul><li><a href="/">Home</a></li><li><a href="/archives">Archives</a></li><li><a href="/about">About</a></li></ul><div class="clearfix"></div></nav><div class="clearfix"></div></header><div id="content" class="inner"><div id="main-col" class="alignleft"><div id="wrapper"><article class="post"><div class="post-content"><header><div class="icon"></div><time datetime="2016-05-18T13:51:24.349Z"><a href="/2016/05/18/custom-mediarequest/">2016-05-18</a></time><h1 class="title"><a href="/2016/05/18/custom-mediarequest/">Custom mediaRequest in Sitecore 8</a></h1></header><div class="entry"><p>For a new project in Sitecore 8, we needed an Image cropper. However, the images needed to be cropped dynamically. We started off by implementing the image cropper made by Anders Laub (found <a href="http://laubplusco.net/make-sitecore-deliver-images-fits-screen-part-2/" target="_blank" rel="external">here</a>). After adding the custom image processor, we could use a few querystring parameters to crop the image. the important ones are:</p><ul><li>cw : crop width</li><li>ch : crop height</li><li>c : indicate that this cropper is to be used</li></ul><p>However, when we got this working we noticed that the image was cached by sitecore, but the new querystring parameters were not. When an image is being processed, a cache is created in the app_data/mediacache folder. In a subfolder the transformed image is stored along with some info in a .ini file. The contents of the file will look something like this:</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[key]</span><br><span class="line">?<span class="keyword">as</span>=False&amp;bc=<span class="number">0</span>&amp;h=<span class="number">0</span>&amp;iar=False&amp;mh=<span class="number">0</span>&amp;mw=<span class="number">0</span>&amp;sc=<span class="number">0</span>&amp;thn=False&amp;w=<span class="number">0</span></span><br><span class="line"></span><br><span class="line">[extension]</span><br><span class="line">png</span><br><span class="line"></span><br><span class="line">[headers]</span><br><span class="line">Content-Type: image/png</span><br><span class="line"></span><br><span class="line">[dataFile]</span><br><span class="line"><span class="number">3</span>f427bbc14fa4e4aa399266c96221b51.png</span><br></pre></td></tr></table></figure><p>The key obviously contains the querystring parameters used in the url to link the image. Notice how all the default parameters are included, but none of the custom ones for the image cropper. To force sitecore to do that you need to write a custom mediarequest class that inherits from the MediaRequest class, found in the Sitecore.Resources.Media namespace. In your new class, you need to override the GetOptions() and Clone() methods of the MediaRequest class. I came up with a super original name for my new class, the CustomMediaRequest class.</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">override</span> MediaRequest <span class="title">Clone</span>(<span class="params"></span>)</span><br><span class="line">      </span>&#123;</span><br><span class="line">          Assert.IsTrue((<span class="keyword">bool</span>)(<span class="keyword">base</span>.GetType() == <span class="keyword">typeof</span>(CustomMediaRequest)), </span><br><span class="line">	<span class="string">"The Clone() method must be overridden to support prototyping."</span>);</span><br><span class="line">          <span class="keyword">return</span> <span class="keyword">new</span> CustomMediaRequest &#123; innerRequest = <span class="keyword">this</span>.innerRequest, mediaUri = <span class="keyword">this</span>.mediaUri,</span><br><span class="line">	options = <span class="keyword">this</span>.options, mediaQueryString = <span class="keyword">this</span>.mediaQueryString &#125;;</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure><p>Since I didnâ€™t need any fancy things done here I basically copied the existing code and changed the MediaRequest to CustomMediaRequest. The GetOptions() method is also mostly a copy of the original, but here I added some code to include the new querystring parameters. The parameters both custom and sitecore ones (KnownOptions) are stored in MediaOptions.</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">this</span>.ProcessCustomParameters(options);                          </span><br><span class="line"></span><br><span class="line">           <span class="keyword">if</span> (!options.CustomOptions.ContainsKey(<span class="string">"c"</span>))</span><br><span class="line">           &#123;</span><br><span class="line">               options.CustomOptions.Add(<span class="string">"c"</span>, queryString.Get(<span class="string">"c"</span>));</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="keyword">else</span></span><br><span class="line">           &#123;</span><br><span class="line">               options.CustomOptions[<span class="string">"c"</span>] = queryString.Get(<span class="string">"c"</span>);</span><br><span class="line">           &#125;</span><br><span class="line"></span><br><span class="line">           <span class="keyword">if</span> (!options.CustomOptions.ContainsKey(<span class="string">"cw"</span>))</span><br><span class="line">           &#123;</span><br><span class="line">               options.CustomOptions.Add(<span class="string">"cw"</span>, queryString.Get(<span class="string">"cw"</span>));</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="keyword">else</span></span><br><span class="line">           &#123;</span><br><span class="line">               options.CustomOptions[<span class="string">"cw"</span>] = queryString.Get(<span class="string">"cw"</span>);</span><br><span class="line">           &#125;</span><br><span class="line"></span><br><span class="line">           <span class="keyword">if</span> (!options.CustomOptions.ContainsKey(<span class="string">"ch"</span>))</span><br><span class="line">           &#123;</span><br><span class="line">               options.CustomOptions.Add(<span class="string">"ch"</span>, queryString.Get(<span class="string">"ch"</span>));</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="keyword">else</span></span><br><span class="line">           &#123;</span><br><span class="line">               options.CustomOptions[<span class="string">"ch"</span>] = queryString.Get(<span class="string">"ch"</span>);</span><br><span class="line">           &#125;</span><br></pre></td></tr></table></figure><p>Finally, we need to add an extra config file in the app_config/include folder. I named mine Sitecore.Media.RequestParser.config since we are replacing the default requestparser with our own.</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;requestParser type=<span class="string">"PioneerDj.SC.Requests.CustomMediaRequest, PioneerDj.SC"</span> </span><br><span class="line">patch:instead=<span class="string">"processor[@type='Sitecore.Resources.Media.MediaRequest, Sitecore.Kernel']"</span> /&gt;</span><br></pre></td></tr></table></figure><p>Notice how we added the patch:instead. Patch:After wonâ€™t work as only one RequestParser is used. you also need to patch the Sitecore.Media.RequestProtection.config file, so that sitecore knows about these parameters.</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;protectedMediaQueryParameters&gt;</span><br><span class="line">  ...</span><br><span class="line">  &lt;parameter description=<span class="string">"crop query key"</span> name=<span class="string">"c"</span>/&gt;</span><br><span class="line">  &lt;parameter description=<span class="string">"crop width query key"</span> name=<span class="string">"cw"</span>/&gt;</span><br><span class="line">  &lt;parameter description=<span class="string">"crop height query key"</span> name=<span class="string">"ch"</span>/&gt;</span><br><span class="line">  &lt;parameter description=<span class="string">"jpeg compression"</span> name=<span class="string">"jq"</span>/&gt;</span><br><span class="line">&lt;/protectedMediaQueryParameters&gt;</span><br><span class="line"></span><br><span class="line">&lt;customMediaQueryParameters&gt;</span><br><span class="line">  &lt;parameter description=<span class="string">"image encoding"</span> name=<span class="string">"enc"</span>/&gt;</span><br><span class="line">&lt;/customMediaQueryParameters&gt;</span><br><span class="line">You need to patch <span class="keyword">this</span> before the renderWebEditing pipeline.</span><br><span class="line"></span><br><span class="line">    &lt;pipelines&gt;</span><br><span class="line">      &lt;renderField&gt;</span><br><span class="line">        &lt;processor patch:before=<span class="string">"processor[@type='Sitecore.Pipelines.RenderField.RenderWebEditing, Sitecore.Kernel']"</span></span><br><span class="line">		type=<span class="string">"Sitecore.Pipelines.RenderField.ProtectedImageLinkRenderer, Sitecore.Kernel"</span> /&gt;</span><br><span class="line">      &lt;/renderField&gt;</span><br><span class="line">    &lt;/pipelines&gt;</span><br></pre></td></tr></table></figure><p>When this is done, the CustomOptions will be added to the querystring and the image cache key in the ini .file will look like this:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[key]</span><br><span class="line">?as=False&amp;bc=0&amp;h=0&amp;iar=False&amp;mh=0&amp;mw=0&amp;sc=0&amp;thn=False&amp;w=0&amp;c=1&amp;ch=550&amp;cw=180</span><br></pre></td></tr></table></figure><p>Now, every time you render the image with different cropping (querystring) settings, a new image is stored in the mediacache (sub)folder and a new key is added to the .ini file. I hope this short tutorial can help someone looking to extend the image caching.</p><p>The complete CustomMediaRequest class:</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line">using System.Collections.Specialized;</span><br><span class="line">using System.Web;</span><br><span class="line">using Sitecore.Configuration;</span><br><span class="line">using Sitecore.Diagnostics;</span><br><span class="line">using Sitecore.Resources.Media;</span><br><span class="line"></span><br><span class="line">namespace YourProject.SC.Requests</span><br><span class="line">&#123;</span><br><span class="line">    public class CustomMediaRequest : MediaRequest</span><br><span class="line">    &#123;</span><br><span class="line">        private HttpRequest innerRequest;</span><br><span class="line">        private bool isRawUrlSafe;</span><br><span class="line">        private bool isRawUrlSafeInitialized;</span><br><span class="line">        private MediaUrlOptions mediaQueryString;</span><br><span class="line">        private Sitecore.Resources.Media.MediaUri mediaUri;</span><br><span class="line">        private MediaOptions options;        </span><br><span class="line"></span><br><span class="line">        protected override MediaOptions GetOptions()</span><br><span class="line">        &#123;           </span><br><span class="line">            NameValueCollection queryString = this.InnerRequest.QueryString;</span><br><span class="line">            if ((queryString == null) || queryString.HasKeys() )</span><br><span class="line">            &#123;</span><br><span class="line">                options = new MediaOptions();</span><br><span class="line">            &#125;</span><br><span class="line">            else</span><br><span class="line">            &#123;</span><br><span class="line">                MediaUrlOptions mediaQueryString = this.GetMediaQueryString();</span><br><span class="line">                options = new MediaOptions</span><br><span class="line">                &#123;</span><br><span class="line">                    AllowStretch = mediaQueryString.AllowStretch,</span><br><span class="line">                    BackgroundColor = mediaQueryString.BackgroundColor,</span><br><span class="line">                    IgnoreAspectRatio = mediaQueryString.IgnoreAspectRatio,</span><br><span class="line">                    Scale = mediaQueryString.Scale,</span><br><span class="line">                    Width = mediaQueryString.Width,</span><br><span class="line">                    Height = mediaQueryString.Height,</span><br><span class="line">                    MaxWidth = mediaQueryString.MaxWidth,</span><br><span class="line">                    MaxHeight = mediaQueryString.MaxHeight,</span><br><span class="line">                    Thumbnail = mediaQueryString.Thumbnail</span><br><span class="line">                &#125;;</span><br><span class="line">                if (mediaQueryString.DisableMediaCache)</span><br><span class="line">                &#123;</span><br><span class="line">                    options.UseMediaCache = false;</span><br><span class="line">                &#125;</span><br><span class="line">                string[] strArray = queryString.AllKeys;</span><br><span class="line">                for (int i = 0; i &lt; strArray.Length; i = (int)(i + 1))</span><br><span class="line">                &#123;</span><br><span class="line">                    string str = strArray[i];</span><br><span class="line">                    if ((str != null) &amp;&amp; (queryString.Get(str) != null))</span><br><span class="line">                    &#123;</span><br><span class="line">                        options.CustomOptions[str] = queryString.Get(str);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            if (!this.IsRawUrlSafe)</span><br><span class="line">            &#123;</span><br><span class="line">                if (Settings.Media.RequestProtection.LoggingEnabled)</span><br><span class="line">                &#123;</span><br><span class="line">                    string urlReferrer = this.GetUrlReferrer();</span><br><span class="line">                    Log.SingleError(string.Format("MediaRequestProtection: An invalid/missing hash value was encountered.</span><br><span class="line">					The expected hash value: &#123;0&#125;. Media URL: &#123;1&#125;, Referring URL: &#123;2&#125;"</span><br><span class="line">                        , HashingUtils.GetAssetUrlHash(this.InnerRequest.Path), this.InnerRequest.Path, string.IsNullOrEmpty(urlReferrer)</span><br><span class="line">						? ((object)"(empty)") : ((object)urlReferrer)), this);</span><br><span class="line">                &#125;</span><br><span class="line">                options = new MediaOptions();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            this.ProcessCustomParameters(options);                          </span><br><span class="line"></span><br><span class="line">            if (!options.CustomOptions.ContainsKey("c"))</span><br><span class="line">            &#123;</span><br><span class="line">                options.CustomOptions.Add("c", queryString.Get("c"));</span><br><span class="line">            &#125;</span><br><span class="line">            else</span><br><span class="line">            &#123;</span><br><span class="line">                options.CustomOptions["c"] = queryString.Get("c");</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            if (!options.CustomOptions.ContainsKey("cw"))</span><br><span class="line">            &#123;</span><br><span class="line">                options.CustomOptions.Add("cw", queryString.Get("cw"));</span><br><span class="line">            &#125;</span><br><span class="line">            else</span><br><span class="line">            &#123;</span><br><span class="line">                options.CustomOptions["cw"] = queryString.Get("cw");</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            if (!options.CustomOptions.ContainsKey("ch"))</span><br><span class="line">            &#123;</span><br><span class="line">                options.CustomOptions.Add("ch", queryString.Get("ch"));</span><br><span class="line">            &#125;</span><br><span class="line">            else</span><br><span class="line">            &#123;</span><br><span class="line">                options.CustomOptions["ch"] = queryString.Get("ch");</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            return options;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public override MediaRequest Clone()</span><br><span class="line">        &#123;</span><br><span class="line">            Assert.IsTrue((bool)(base.GetType() == typeof(CustomMediaRequest)),</span><br><span class="line">			"The Clone() method must be overridden to support prototyping.");</span><br><span class="line">            return new CustomMediaRequest &#123; innerRequest = this.innerRequest,</span><br><span class="line">			mediaUri = this.mediaUri, options = this.options, mediaQueryString = this.mediaQueryString &#125;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>The complete Sitecore.Media.RequestParser.config file:</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">"1.0"</span>?&gt;</span><br><span class="line">&lt;configuration xmlns:patch=<span class="string">"http://www.sitecore.net/xmlconfig/"</span>&gt;</span><br><span class="line">&lt;sitecore&gt;</span><br><span class="line">	&lt;mediaLibrary&gt;</span><br><span class="line">	&lt;requestParser type=<span class="string">"PioneerDj.SC.Requests.CustomMediaRequest, PioneerDj.SC"</span>  </span><br><span class="line">	patch:instead=<span class="string">"processor[@type='Sitecore.Resources.Media.MediaRequest, Sitecore.Kernel']"</span> /&gt;</span><br><span class="line">	&lt;/mediaLibrary&gt;</span><br><span class="line">&lt;/sitecore&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br></pre></td></tr></table></figure><p>Finally Iâ€™d like to thank <a href="http://laubplusco.net/" target="_blank" rel="external">Anders Laub</a>, for his excellent Sitecore blog and image cropper code.</p></div><footer><div class="clearfix"></div></footer></div></article><article class="post"><div class="post-content"><header><div class="icon"></div><time datetime="2016-05-18T13:43:26.473Z"><a href="/2016/05/18/googlemaps-autocomplete-filter-multiple-countries/">2016-05-18</a></time><h1 class="title"><a href="/2016/05/18/googlemaps-autocomplete-filter-multiple-countries/">Google maps autocomplete filter by multiple countries</a></h1></header><div class="entry"><p>At the end of last year (2014) I had to modify an existing Google maps autocomplete to filter by multiple countries. To my horror I discovered this was not possible, in fact the issue / feature request has been logged since 2012 (google issue) without any real fix. So I had to work around it.</p><p>I found out it is possible to get Autocomplete predictions, but sadly they suffer from the same shortcoming. However the predictions return a list of, well predictions allowing the developer to make their own lists. So thatâ€™s what I did and after sprinkling some jQuery around I came up with my own custom Autocomplete.</p><p>I only had to search a secondary country (Luxemburg) when the current country was Belgium, thatâ€™s why those countries are hard coded in the demo example. Feel free to use the code and change it in any way.</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line"></span><br><span class="line">    &lt;html&gt;</span><br><span class="line">    &lt;head&gt;</span><br><span class="line">    &lt;title&gt;Retrieving Autocomplete Predictions&lt;/title&gt;</span><br><span class="line">    &lt;script type=<span class="string">"text/javascript"</span> src=<span class="string">"jquery.js"</span>&gt;&lt;/script&gt;</span><br><span class="line">    &lt;script type=<span class="string">"text/javascript"</span> src=<span class="string">"https://maps.googleapis.com/maps/api/js?libraries=places&amp;v=3.exp"</span>&gt;&lt;/script&gt;</span><br><span class="line">    &lt;script&gt;</span><br><span class="line"></span><br><span class="line">    <span class="function">function <span class="title">initialize</span>(<span class="params"></span>) </span>&#123;  </span><br><span class="line">       $(<span class="string">"#place"</span>).live(<span class="string">"keyup"</span>, function (evt) &#123;           </span><br><span class="line">            <span class="comment">// Clear any previously set timer before setting a new one</span></span><br><span class="line">            window.clearTimeout($(<span class="keyword">this</span>).data(<span class="string">"timeout"</span>));</span><br><span class="line">            $(<span class="keyword">this</span>).data(<span class="string">"timeout"</span>, setTimeout(function () &#123;</span><br><span class="line">                <span class="comment">//whe the timeout has expired get the predictions</span></span><br><span class="line">                <span class="keyword">var</span> inputData = $(<span class="string">"#place"</span>).val();          </span><br><span class="line">                service = <span class="keyword">new</span> google.maps.places.AutocompleteService();</span><br><span class="line">                <span class="keyword">var</span> request = &#123;</span><br><span class="line">                    input: inputData,</span><br><span class="line">                    componentRestrictions: &#123;country: <span class="string">'be'</span>&#125;,</span><br><span class="line">                &#125;;</span><br><span class="line">                <span class="keyword">var</span> secondaryRequest = &#123;</span><br><span class="line">                    input: inputData,</span><br><span class="line">                    componentRestrictions: &#123;country: <span class="string">'lu'</span>&#125;,</span><br><span class="line">                &#125;;</span><br><span class="line">                $(<span class="string">'#resultWindow'</span>).empty();</span><br><span class="line">                service.getPlacePredictions(request, callback);</span><br><span class="line">                service.getPlacePredictions(secondaryRequest, callback);            </span><br><span class="line">            &#125;, <span class="number">1000</span>));</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="function">function <span class="title">callback</span>(<span class="params">predictions, status</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (status != google.maps.places.PlacesServiceStatus.OK) &#123;</span><br><span class="line">                console.log(status);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;    </span><br><span class="line">            <span class="keyword">var</span> resultHTML = <span class="string">''</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, prediction; prediction = predictions[i]; i++) &#123;</span><br><span class="line">                resultHTML += <span class="string">'&lt;div&gt;'</span> + prediction.description + <span class="string">'&lt;/div&gt;'</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>($(<span class="string">'#resultWindow'</span>).html() != undefined &amp;&amp; $(<span class="string">'#resultWindow'</span>).html() != <span class="string">''</span>)&#123;      </span><br><span class="line">                resultHTML = $(<span class="string">'#resultWindow'</span>).html()+ resultHTML;</span><br><span class="line">            &#125;       </span><br><span class="line">            <span class="keyword">if</span>(resultHTML != undefined &amp;&amp; resultHTML != <span class="string">''</span>)&#123;        </span><br><span class="line">                $(<span class="string">'#resultWindow'</span>).html(resultHTML).show();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//add the "powered by google" image at the bottom -&gt; required!!</span></span><br><span class="line">            <span class="keyword">if</span>($(<span class="string">'#resultWindow'</span>).html() != undefined)&#123;</span><br><span class="line">                $(<span class="string">'#resultWindow #googleImage'</span>).remove();</span><br><span class="line">                <span class="keyword">var</span> imageHtml = $(<span class="string">'#resultWindow'</span>).html() </span><br><span class="line">				+ <span class="string">'&lt;img id="googleImage" src="powered-by-google-on-white2.png"/&gt;'</span>;</span><br><span class="line">                $(<span class="string">'#resultWindow'</span>).html(imageHtml);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function">function <span class="title">geocodeAddress</span>(<span class="params">address</span>) </span>&#123;      </span><br><span class="line">            <span class="keyword">var</span> geocoder = <span class="keyword">new</span> google.maps.Geocoder();      </span><br><span class="line">            geocoder.geocode(&#123;<span class="string">'address'</span>: address&#125;, function (results, status) </span><br><span class="line">            &#123;   </span><br><span class="line">              <span class="keyword">if</span> (status == google.maps.GeocoderStatus.OK) </span><br><span class="line">              &#123;</span><br><span class="line">                $(<span class="string">'#latitude'</span>).val(results[<span class="number">0</span>].geometry.location.lat());</span><br><span class="line">                $(<span class="string">'#longitude'</span>).val(results[<span class="number">0</span>].geometry.location.lng());        </span><br><span class="line">              &#125;</span><br><span class="line">              <span class="keyword">else</span> &#123;</span><br><span class="line">                console.log(<span class="string">"Error: "</span> + google.maps.GeocoderStatus);</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        $(<span class="string">'#resultWindow div'</span>).live(<span class="string">'click'</span>,function()&#123;</span><br><span class="line">            <span class="comment">//get the coÃ¶rdinates for the selected (clicked) address</span></span><br><span class="line">            $(<span class="string">'#resultWindow'</span>).hide();</span><br><span class="line">            <span class="keyword">var</span> address = $(<span class="keyword">this</span>).text();</span><br><span class="line">            <span class="keyword">var</span> addressParts = address.split(<span class="string">','</span>);</span><br><span class="line">            $(<span class="string">'#country'</span>).val(addressParts[<span class="number">2</span>]);</span><br><span class="line">            $(<span class="string">'#city'</span>).val(addressParts[<span class="number">1</span>]);</span><br><span class="line">            $(<span class="string">'#place'</span>).val(addressParts[<span class="number">0</span>]);</span><br><span class="line">            <span class="keyword">if</span>(address != <span class="string">''</span>)&#123;</span><br><span class="line">                geocodeAddress(address);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">      <span class="comment">/*end custom autocomplete stuff*/</span></span><br><span class="line">    &#125;</span><br><span class="line">    google.maps.<span class="keyword">event</span>.addDomListener(window, <span class="string">'load'</span>, initialize);</span><br><span class="line"></span><br><span class="line">    &lt;/script&gt;</span><br><span class="line">    &lt;style type=<span class="string">"text/css"</span>&gt;</span><br><span class="line">    <span class="meta">#resultWindow&#123;  </span></span><br><span class="line">        position: <span class="keyword">fixed</span>;</span><br><span class="line">       <span class="comment">/* top: 0;</span><br><span class="line">        left: 0;</span><br><span class="line">        width: 100%;</span><br><span class="line">        height: 100%;*/</span></span><br><span class="line">        background-color: <span class="meta">#fff;</span></span><br><span class="line">        filter:alpha(opacity=<span class="number">50</span>);</span><br><span class="line">        -moz-opacity:<span class="number">0.5</span>;</span><br><span class="line">        -khtml-opacity: <span class="number">0.5</span>;</span><br><span class="line">        opacity: <span class="number">0.5</span>;</span><br><span class="line">        z-index: <span class="number">10000</span>;</span><br><span class="line">        border: <span class="number">1</span>px solid black;</span><br><span class="line">        color:black;</span><br><span class="line">        display:none;</span><br><span class="line">    &#125;</span><br><span class="line">    &lt;/style&gt;</span><br><span class="line">    &lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div id=<span class="string">"placeholder"</span>&gt;  </span><br><span class="line">    &lt;input type=<span class="string">"text"</span> id=<span class="string">"place"</span> style=<span class="string">"width:200px;"</span>/&gt;</span><br><span class="line">    &lt;label <span class="keyword">for</span>=<span class="string">"latitude"</span>&gt;Latitude&lt;/label&gt;</span><br><span class="line">    &lt;input type=<span class="string">"text"</span> id=<span class="string">"latitude"</span>/&gt;</span><br><span class="line">    &lt;label <span class="keyword">for</span>=<span class="string">"longitude"</span>&gt;Longitude&lt;/label&gt;</span><br><span class="line">    &lt;input type=<span class="string">"text"</span> id=<span class="string">"longitude"</span>/&gt;</span><br><span class="line">    &lt;label <span class="keyword">for</span>=<span class="string">"city"</span>&gt;city&lt;/label&gt;</span><br><span class="line">    &lt;input type=<span class="string">"text"</span> id=<span class="string">"city"</span>/&gt;</span><br><span class="line">    &lt;label <span class="keyword">for</span>=<span class="string">"country"</span>&gt;selected country&lt;/label&gt;</span><br><span class="line">    &lt;input type=<span class="string">"text"</span> id=<span class="string">"country"</span>/&gt;</span><br><span class="line">    &lt;div id=<span class="string">"resultWindow"</span>&gt;&lt;/div&gt;   </span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure></div><footer><div class="clearfix"></div></footer></div></article><article class="post"><div class="post-content"><header><div class="icon"></div><time datetime="2016-05-18T10:57:42.746Z"><a href="/2016/05/18/mvc/sitecore-multiple-forms-on-a-page/">2016-05-18</a></time><h1 class="title"><a href="/2016/05/18/mvc/sitecore-multiple-forms-on-a-page/">Sitecore multiple forms on one page - view renderings</a></h1></header><div class="entry"><p>I was trying to read out form values after a POST and was reminded by a colleague that all controller actions will be able to render the form. That simply will not do. He referred me to some excellent blog posts which offer a solution for the controller renderings. Check out Reinoud Van Dalenâ€™s ultimate fix for multiple forms on one page with sitecore mvc</p><p>However I happened to have a view rendering on the receiving end of the form post. This blog post will explain how you can apply the same principle to view rendering.</p><h3 id="create-a-sitecorehelperextension">Create a sitecoreHelperExtension</h3><p>This code was copied form Reinoudâ€™s solution, with a small modification to allow the developer to choose his own id (in case you want to use the id from some kind of generated code)</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> MvcHtmlString <span class="title">RenderingToken</span>(<span class="params"><span class="keyword">this</span> SitecoreHelper helper, <span class="keyword">string</span> id = <span class="keyword">null</span></span>)</span><br><span class="line"></span>&#123;</span><br><span class="line">   <span class="keyword">if</span> (helper.CurrentRendering == <span class="keyword">null</span>)</span><br><span class="line">   &#123;</span><br><span class="line">     <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">var</span> tagBuilder = <span class="keyword">new</span> TagBuilder(<span class="string">"input"</span>);</span><br><span class="line">   tagBuilder.Attributes[<span class="string">"type"</span>] = <span class="string">"hidden"</span>;</span><br><span class="line">   tagBuilder.Attributes[<span class="string">"name"</span>] = <span class="string">"uid"</span>;</span><br><span class="line">   tagBuilder.Attributes[<span class="string">"value"</span>] = id ?? helper.CurrentRendering.UniqueId.ToString();</span><br><span class="line"></span><br><span class="line">   <span class="keyword">return</span> <span class="keyword">new</span> MvcHtmlString(tagBuilder.ToString(TagRenderMode.SelfClosing));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="update-your-form">Update your form</h3><p>You can call this without a parameter and it will use the id of the current rendering (default).</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@Html.Sitecore().RenderingToken()</span><br></pre></td></tr></table></figure><p>Alternatively you could call it using a custom Id, in this case the item Id from our generated code</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@Html.Sitecore().RenderingToken(ItemTree.Layout.Renderings.MyRendering.ItemID.ToGuid().ToString())</span><br></pre></td></tr></table></figure><p>This will generate a hidden field with the unique id of the current rendering (or the ID of your choice). That value will then get posted with the rest of you form.</p><p><strong>remark</strong> the ToGuid() method will remove the curly braces. You can skip that if you donâ€™t mind them in you values. Just donâ€™t forget to use the same structure (with or without curly braces) when reading it back out.</p><h3 id="creating-a-form-extension">Creating a form Extension</h3><p>The first method checks for the correct source form. It does this by comparing the posted Id with the Id you provide it in the renderId parameter. The second method reads the form value in case the source is confirmed to be the correct form.</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title">FormExtensions</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">bool</span> <span class="title">IsSourceForm</span>(<span class="params"><span class="keyword">this</span> HttpRequestBase request, <span class="keyword">string</span> renderId, <span class="keyword">string</span> sourceField = <span class="keyword">null</span></span>)</span><br><span class="line">    </span>&#123;</span><br><span class="line">        <span class="keyword">string</span> sourceFieldName = sourceField ?? <span class="string">"uid"</span>;</span><br><span class="line">        <span class="keyword">return</span> request.Form != <span class="keyword">null</span> &amp;&amp; !request.Form[sourceFieldName].IsNullOrEmpty() &amp;&amp;</span><br><span class="line">                   request.Form[sourceFieldName].Equals(renderId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">string</span> <span class="title">GetFormSourceValue</span>(<span class="params"><span class="keyword">this</span> HttpRequestBase request, <span class="keyword">string</span> renderId,</span><br><span class="line"> 	<span class="keyword">string</span> formFieldName, <span class="keyword">string</span> sourceFieldName = <span class="keyword">null</span></span>)</span><br><span class="line">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!IsSourceForm(request, renderId, sourceFieldName))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> request.Form[formFieldName].HasValue() </span><br><span class="line">			? request.Form[formFieldName] </span><br><span class="line">			: <span class="keyword">string</span>.Empty;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Hereâ€™s the one liner on how to get the value you want, from the form you want .</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> formID = ItemTree.Layout.Renderings.MyRendering.ItemID.ToGuid().ToString();</span><br><span class="line"><span class="keyword">var</span> formValue = Request.GetFormSourceValue(formID, <span class="string">"name of form value"</span>);</span><br></pre></td></tr></table></figure></div><footer><div class="clearfix"></div></footer></div></article><nav id="pagination"><a href="/page/4/" class="alignleft prev">Prev</a><div class="clearfix"></div></nav></div></div><aside id="sidebar" class="alignright"><a href="https://twitter.com/RubenVerschuern" class="twitter-follow-button" data-show-count="false" data-size="large">Follow @RubenVerschuern</a><script>!function(t,e,r){var n,s=t.getElementsByTagName(e)[0],i=/^http:/.test(t.location)?"http":"https";t.getElementById(r)||(n=t.createElement(e),n.id=r,n.src=i+"://platform.twitter.com/widgets.js",s.parentNode.insertBefore(n,s))}(document,"script","twitter-wjs")</script><div class="widget tag"><h3 class="title">Tags</h3><ul class="entry"><li><a href="/tags/adyen-skin/">adyen skin</a><small>1</small></li><li><a href="/tags/autocomplete/">autocomplete</a><small>1</small></li><li><a href="/tags/blog/">blog</a><small>1</small></li><li><a href="/tags/browser-extensions/">browser extensions</a><small>1</small></li><li><a href="/tags/cheat-sheet/">cheat sheet</a><small>1</small></li><li><a href="/tags/extension-methods/">extension methods</a><small>1</small></li><li><a href="/tags/filter/">filter</a><small>1</small></li><li><a href="/tags/google-maps/">google maps</a><small>1</small></li><li><a href="/tags/hpp/">hpp</a><small>1</small></li><li><a href="/tags/itemlink/">itemlink</a><small>1</small></li><li><a href="/tags/javascript/">javascript</a><small>2</small></li><li><a href="/tags/maintenance/">maintenance</a><small>1</small></li><li><a href="/tags/markdown/">markdown</a><small>1</small></li><li><a href="/tags/mediarequest/">mediarequest</a><small>1</small></li><li><a href="/tags/migrate/">migrate</a><small>1</small></li><li><a href="/tags/multiple-renderings/">multiple renderings</a><small>1</small></li><li><a href="/tags/mvc/">mvc</a><small>1</small></li><li><a href="/tags/pdf/">pdf</a><small>1</small></li><li><a href="/tags/plugins/">plugins</a><small>1</small></li><li><a href="/tags/resharper/">resharper</a><small>1</small></li><li><a href="/tags/shortcut/">shortcut</a><small>1</small></li><li><a href="/tags/sitecore/">sitecore</a><small>2</small></li><li><a href="/tags/sitecore-8/">sitecore 8</a><small>4</small></li><li><a href="/tags/sql/">sql</a><small>3</small></li><li><a href="/tags/sql-server/">sql server</a><small>1</small></li><li><a href="/tags/t-sql/">t-sql</a><small>1</small></li><li><a href="/tags/tools/">tools</a><small>1</small></li><li><a href="/tags/ucommerce/">ucommerce</a><small>3</small></li><li><a href="/tags/unit-testing/">unit testing</a><small>1</small></li><li><a href="/tags/upgrade/">upgrade</a><small>1</small></li><li><a href="/tags/visual-studio/">visual studio</a><small>1</small></li></ul></div></aside><div class="clearfix"></div></div><footer id="footer" class="inner"><div class="alignleft">&copy; 2016 Ruben Verschueren</div><div class="clearfix"></div></footer><script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script><script src="/js/jquery.imagesloaded.min.js"></script><script src="/js/gallery.js"></script><script type="text/javascript">var disqus_shortname="sitecorn";!function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="//"+disqus_shortname+".disqus.com/count.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)}()</script><link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css"><script src="/fancybox/jquery.fancybox.pack.js"></script><script type="text/javascript">!function(n){n(".fancybox").fancybox()}(jQuery)</script></body><!-- rebuild by neat -->