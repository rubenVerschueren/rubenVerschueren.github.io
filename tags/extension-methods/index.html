<!-- build time:Fri Oct 07 2016 17:34:30 GMT+0200 (Romance Daylight Time) --><!DOCTYPE HTML><html><head><meta charset="utf-8"><title>extension methods | Sitecorn</title><meta name="author" content="Ruben Verschueren"><meta name="description" content="web development tips &amp; tricks"><meta name="og:description" content="web development tips &amp; tricks"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta property="og:site_name" content="Sitecorn"><meta property="og:url" content="http://www.sitecorn.be/tags/extension-methods/index.html"><meta property="og:image" content="http://www.sitecorn.be/images/sitecorn_large.png"><meta property="og:image:width" content="100"><meta property="og:image:height" content="121"><link rel="icon" type="image/png" href="http://www.sitecorn.be/images/fav.ico"><link href="http://www.sitecorn.be/images/sitecorn_large.png" rel="icon"><link rel="alternate" href="/atom.xml" title="Sitecorn" type="application/atom+xml"><link rel="stylesheet" href="/css/style.css" media="screen" type="text/css"><link rel="stylesheet" href="/css/custom.css" media="screen" type="text/css"><script>!function(e,a,t,n,c,o,s){e.GoogleAnalyticsObject=c,e[c]=e[c]||function(){(e[c].q=e[c].q||[]).push(arguments)},e[c].l=1*new Date,o=a.createElement(t),s=a.getElementsByTagName(t)[0],o.async=1,o.src=n,s.parentNode.insertBefore(o,s)}(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create","UA-76954315-1","auto"),ga("send","pageview")</script></head></html><body><header id="header" class="inner"><div class="alignleft"><h1><a href="/">Sitecorn</a></h1><h2><a href="/">offering a few kernels of knowledge</a></h2></div><nav id="main-nav" class="alignright"><ul><li><a href="/">Home</a></li><li><a href="/archives">Archives</a></li><li><a href="/about">About</a></li></ul><div class="clearfix"></div></nav><div class="clearfix"></div></header><div id="content" class="inner"><div id="main-col" class="alignleft"><div id="wrapper"><h2 class="archive-title tag">extension methods</h2><div class="archive"><article class="post"><div class="post-content"><header><div class="icon"></div><time datetime="2016-07-08T12:17:50.462Z"><a href="/2016/07/08/ucommerce-extensions/">2016-07-08</a></time><h1 class="title"><a href="/2016/07/08/ucommerce-extensions/">UCommerce Extensions</a></h1></header><div class="entry"><p>Over the course of my first Sitecore 8 and UCommerce integration project I’ve created some extension methods that might be useful in other projects. Most of these are straight forward so let’s dive into it.</p><h3 id="basket">Basket</h3><p><strong>the culture difference</strong></p><p>In case you have different stores for different you need to keep your baskets separated. You cannot have a basket with product X with Euro as currency and product Y with Dollars as currency. So what we decided to do is delete the existing basket when the visitor browses a different Country website. Our site had a country/language selector which allowed the visitor to do that.</p><p>The following code does just that. It checks if the basket culture corresponds with the SiteContext culture.</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">EnsureBasketCulture</span>(<span class="params"><span class="keyword">this</span> Basket basket</span>)</span><br><span class="line"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (!basket.PurchaseOrder.CultureCode.Equals(SiteContext.Current.CurrentCulture.Name))</span><br><span class="line">	&#123;	</span><br><span class="line">		SiteContext.Current.OrderContext.ClearBasketInformation();</span><br><span class="line">		basket = SiteContext.Current.OrderContext.GetBasket();</span><br><span class="line">		basket.PurchaseOrder.Save();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Now in case you may not want to loose any basket data, so we want to save that. The following code adds a summary of the existing basket in an audit trail in the new one. Now you might be thinking you want to add the order lines to the new basket and you can do that. However it was out of scope for our project and it could lead you down the rabbit hole since you would have to check if the product is sold in the new country, the prices might be different between countries, not to mention taxes and so on.</p><p>This code is just example and you might want to be more defensive in your coding, it’s merely for reference.</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">EnsureBasketCulture</span>(<span class="params"><span class="keyword">this</span> Basket basket</span>)</span><br><span class="line"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (!basket.PurchaseOrder.CultureCode.Equals(SiteContext.Current.CurrentCulture.Name))</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">string</span> summary = <span class="keyword">string</span>.Empty;</span><br><span class="line">		<span class="keyword">if</span> (basket.PurchaseOrder != <span class="keyword">null</span> &amp;&amp; basket.PurchaseOrder.OrderLines.Any())</span><br><span class="line">		&#123;</span><br><span class="line">		    summary = <span class="keyword">string</span>.Join(<span class="string">" | "</span>, basket.PurchaseOrder.OrderLines.Select(</span><br><span class="line">		              l =&gt; <span class="keyword">string</span>.Format(<span class="string">"&#123;0&#125; - #&#123;1&#125;"</span>, l.ProductName, l.Quantity)));</span><br><span class="line">		&#125;</span><br><span class="line">		SiteContext.Current.OrderContext.ClearBasketInformation();</span><br><span class="line">		basket = SiteContext.Current.OrderContext.GetBasket();</span><br><span class="line">		basket.PurchaseOrder.Save();</span><br><span class="line"></span><br><span class="line">		<span class="keyword">var</span> auditline = <span class="keyword">new</span> OrderStatusAudit();</span><br><span class="line">		<span class="keyword">var</span> order = basket.PurchaseOrder;</span><br><span class="line">		auditline.CreatedOn = DateTime.Now;</span><br><span class="line">		auditline.Message = <span class="keyword">string</span>.Format(<span class="string">"Country changed, new basket created: &#123;0&#125;"</span>, summary);</span><br><span class="line">		auditline.PurchaseOrder = order;</span><br><span class="line">		auditline.NewOrderStatus = basket.PurchaseOrder.OrderStatus;               </span><br><span class="line">		auditline.Save();</span><br><span class="line">		order.AddOrderStatusAudit(auditline);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="payment-method">Payment method</h3><p><strong>the delivery date modification</strong></p><p>In the Adyen payment method properties you can set standard shipping time. To be able to show the estimated delivery date of the order, we added the following extension method. It simply retrieves the properties from the payment method and corrects the date (adding only business days).</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> DateTime <span class="title">GetDateAdjustment</span>(<span class="params">PaymentMethod paymentMethod</span>)</span><br><span class="line"></span>&#123;</span><br><span class="line">	AdyenPaymentMethodProperties properties = <span class="keyword">new</span> AdyenPaymentMethodProperties(paymentMethod.PaymentMethodProperties);</span><br><span class="line">	<span class="keyword">string</span> shipDays = properties.ShipDays;</span><br><span class="line">	<span class="keyword">string</span> shipHours = properties.ShipHours;</span><br><span class="line">	<span class="keyword">string</span> shipMinutes = properties.ShipMinutes;</span><br><span class="line"></span><br><span class="line">	DateTime shipBefore = DateTime.Now;</span><br><span class="line">	<span class="keyword">if</span> (!<span class="keyword">string</span>.IsNullOrEmpty(shipDays))</span><br><span class="line">	&#123;</span><br><span class="line">		shipBefore = shipBefore.AddBusinessDays(<span class="keyword">int</span>.Parse(shipDays));</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (!<span class="keyword">string</span>.IsNullOrEmpty(shipHours))</span><br><span class="line">	&#123;</span><br><span class="line">		shipBefore = shipBefore.AddHours(<span class="keyword">int</span>.Parse(shipHours));</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (!<span class="keyword">string</span>.IsNullOrEmpty(shipMinutes))</span><br><span class="line">	&#123;</span><br><span class="line">		shipBefore = shipBefore.AddMinutes(<span class="keyword">int</span>.Parse(shipMinutes));</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> shipBefore;            </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>the property enquiry</strong></p><p>The following extension method avoids duplicating the same code each time you need to access a payment method property. I also saves a lot of time trying to figure out how to do that again.</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">string</span> <span class="title">GetPaymentMethodPropertiesValue</span>(<span class="params"><span class="keyword">this</span> ICollection&lt;PaymentMethodProperty&gt; properties, <span class="keyword">string</span> key</span>)</span><br><span class="line"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> properties.FirstOrDefault(p =&gt; p.DefinitionField != <span class="keyword">null</span> &amp;&amp; p.DefinitionField.Name.Equals(key)).Value;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="puchaseorder">PuchaseOrder</h3><p><strong>the American way</strong> As we had quite a lot of divergent logic for the US, I added this extension method that inspects the culture to find out if the order is in place in/for the US.</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">bool</span> <span class="title">IsAmerican</span>(<span class="params"><span class="keyword">this</span> PurchaseOrder order</span>)</span><br><span class="line"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> order.CultureCode.Equals(<span class="string">"en-US"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>the pipeline verification</strong></p><p>Sometimes something happens, some times it’s bad. let’s leave it at that. I needed to check if the Checkout pipeline was executed or not, so here’s the code.</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">bool</span> <span class="title">CheckoutPipelineHasAlreadyBeenExecutedForPayment</span>(<span class="params"><span class="keyword">this</span> PurchaseOrder order</span>)</span><br><span class="line"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (order.OrderStatus.OrderStatusId == (<span class="keyword">int</span>)OrderStatusCode.Basket ||</span><br><span class="line">	   order.OrderStatus.OrderStatusId == (<span class="keyword">int</span>)OrderStatusCode.Processing)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>the order number assignment</strong></p><p>In case you want to assign an order number at some random point in the order process, this extension method will let you do that. We used it to assign the order number when the customer reaches the confirmation page and the payment was authorised.</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">public static void AssignOrdernumberIfEmpty(this PurchaseOrder order,string source = "PurchaseOrderExtension")</span><br><span class="line">&#123;</span><br><span class="line">	if (string.IsNullOrEmpty(order.OrderNumber))</span><br><span class="line">	&#123;                            </span><br><span class="line">		try</span><br><span class="line">		&#123;</span><br><span class="line">			var numberSeriesService = ObjectFactory.Instance.Resolve&lt;INumberSeriesService&gt;();</span><br><span class="line">			order.OrderNumber =</span><br><span class="line">				numberSeriesService.GetNumber(order.ProductCatalogGroup.OrderNumberSerie.OrderNumberName);</span><br><span class="line">			Log.Info(string.Format("Assigning order number to order. id:</span><br><span class="line">			&#123;0&#125;, number &#123;1&#125;", order.OrderId, order.OrderNumber),source);</span><br><span class="line">			order.Save();</span><br><span class="line">		&#125;</span><br><span class="line">		catch (Exception ex)</span><br><span class="line">		&#123;</span><br><span class="line">			Log.Error(string.Format("An error occured assingning the order ordernumber to order (ID): &#123;0&#125;"</span><br><span class="line">			,order.OrderId) ,ex);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="custom-model">Custom Model</h3><p><strong>the currency format issue</strong></p><p>The UCommerce version we were using 6.x had a fixed currency format. So I wrote this class so I could make my own money. You can provide a currency format to the ToString method or use the default one. In our project we only displayed decimals when they’re not zero.</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MyMoney</span> : <span class="title">Money</span></span><br><span class="line">&#123;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="title">MyMoney</span>(<span class="params"><span class="keyword">decimal</span> <span class="keyword">value</span>, CultureInfo culture, Currency currency</span>) </span><br><span class="line">   : <span class="title">base</span>(<span class="params"><span class="keyword">value</span>, culture, currency</span>)</span><br><span class="line">   </span>&#123;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="title">MyMoney</span>(<span class="params"><span class="keyword">decimal</span> <span class="keyword">value</span>, Currency currency</span>) : <span class="title">base</span>(<span class="params"><span class="keyword">value</span>, currency</span>)</span><br><span class="line">   </span>&#123;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="title">MyMoney</span>(<span class="params">Money money</span>) : <span class="title">base</span>(<span class="params">money.Value, money.Culture, money.Currency</span>)</span><br><span class="line">   </span>&#123;</span><br><span class="line">	  </span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//uCommerce ToString method has a fixed currency format</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">string</span> <span class="title">ToString</span>(<span class="params"><span class="keyword">string</span> format</span>)</span><br><span class="line">   </span>&#123;</span><br><span class="line">	   <span class="keyword">if</span> (format.IsNullOrEmpty())</span><br><span class="line">	   &#123;</span><br><span class="line">		   format = <span class="string">"C0"</span>;</span><br><span class="line">	   &#125;</span><br><span class="line">	   <span class="keyword">string</span> cultureSpecificStringValue = Value.ToString(format, Culture);</span><br><span class="line">	   <span class="keyword">return</span> cultureSpecificStringValue;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   <span class="comment">//should return the value with 2 decimals if it is not a whole number</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">string</span> <span class="title">ToString</span>(<span class="params"></span>)</span><br><span class="line">   </span>&#123;</span><br><span class="line">	   <span class="keyword">string</span> format = <span class="string">"C0"</span>;</span><br><span class="line">	   <span class="keyword">if</span> (Value - Math.Truncate(Value) &gt; <span class="number">0</span>)</span><br><span class="line">	   &#123;</span><br><span class="line">		   format = <span class="string">"c2"</span>;</span><br><span class="line">	   &#125;</span><br><span class="line">	   <span class="keyword">return</span> ToString(format);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>the money maker</strong></p><p>Here’s how you would use that. Let’s say you’re displaying the cost of a product in an orderline. Since the ultimate goal of e-commerce it to turn the product value into cash, we can do that in code. Let’s convert the product cost to MyMoney.</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">string</span> displayValue = <span class="keyword">new</span> MyMoney(orderline.Total.GetValueOrDefault(), </span><br><span class="line">orderline.PurchaseOrder.BillingCurrency).ToString();</span><br></pre></td></tr></table></figure></div></div></article></div></div></div><aside id="sidebar" class="alignright"><a href="https://twitter.com/RubenVerschuern" class="twitter-follow-button" data-show-count="false" data-size="large">Follow @RubenVerschuern</a><script>!function(t,e,r){var n,s=t.getElementsByTagName(e)[0],i=/^http:/.test(t.location)?"http":"https";t.getElementById(r)||(n=t.createElement(e),n.id=r,n.src=i+"://platform.twitter.com/widgets.js",s.parentNode.insertBefore(n,s))}(document,"script","twitter-wjs")</script><div class="widget tag"><h3 class="title">Tags</h3><ul class="entry"><li><a href="/tags/adyen-skin/">adyen skin</a><small>1</small></li><li><a href="/tags/autocomplete/">autocomplete</a><small>1</small></li><li><a href="/tags/blog/">blog</a><small>1</small></li><li><a href="/tags/browser-extensions/">browser extensions</a><small>1</small></li><li><a href="/tags/cheat-sheet/">cheat sheet</a><small>1</small></li><li><a href="/tags/extension-methods/">extension methods</a><small>1</small></li><li><a href="/tags/filter/">filter</a><small>1</small></li><li><a href="/tags/google-maps/">google maps</a><small>1</small></li><li><a href="/tags/hpp/">hpp</a><small>1</small></li><li><a href="/tags/itemlink/">itemlink</a><small>1</small></li><li><a href="/tags/javascript/">javascript</a><small>2</small></li><li><a href="/tags/markdown/">markdown</a><small>1</small></li><li><a href="/tags/mediarequest/">mediarequest</a><small>1</small></li><li><a href="/tags/migrate/">migrate</a><small>1</small></li><li><a href="/tags/multiple-renderings/">multiple renderings</a><small>1</small></li><li><a href="/tags/mvc/">mvc</a><small>1</small></li><li><a href="/tags/pdf/">pdf</a><small>1</small></li><li><a href="/tags/plugins/">plugins</a><small>1</small></li><li><a href="/tags/resharper/">resharper</a><small>1</small></li><li><a href="/tags/shortcut/">shortcut</a><small>1</small></li><li><a href="/tags/sitecore/">sitecore</a><small>1</small></li><li><a href="/tags/sitecore-8/">sitecore 8</a><small>4</small></li><li><a href="/tags/sql/">sql</a><small>3</small></li><li><a href="/tags/tools/">tools</a><small>1</small></li><li><a href="/tags/ucommerce/">ucommerce</a><small>3</small></li><li><a href="/tags/unit-testing/">unit testing</a><small>1</small></li><li><a href="/tags/upgrade/">upgrade</a><small>1</small></li><li><a href="/tags/visual-studio/">visual studio</a><small>1</small></li></ul></div></aside><div class="clearfix"></div></div><footer id="footer" class="inner"><div class="alignleft">&copy; 2016 Ruben Verschueren</div><div class="clearfix"></div></footer><script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script><script src="/js/jquery.imagesloaded.min.js"></script><script src="/js/gallery.js"></script><script type="text/javascript">var disqus_shortname="sitecorn";!function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="//"+disqus_shortname+".disqus.com/count.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)}()</script><link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css"><script src="/fancybox/jquery.fancybox.pack.js"></script><script type="text/javascript">!function(n){n(".fancybox").fancybox()}(jQuery)</script></body><!-- rebuild by neat -->