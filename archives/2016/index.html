<!-- build time:Thu Sep 08 2016 15:40:17 GMT+0200 (Romance Daylight Time) --><!DOCTYPE HTML><html><head><meta charset="utf-8"><title>Archives: 2016 | Sitecorn</title><meta name="author" content="Ruben Verschueren"><meta name="description" content="web development tips &amp; tricks"><meta name="og:description" content="web development tips &amp; tricks"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta property="og:site_name" content="Sitecorn"><meta property="og:url" content="http://www.sitecorn.be/archives/2016/index.html"><meta property="og:image" content="http://www.sitecorn.be/images/sitecorn_large.png"><meta property="og:image:width" content="100"><meta property="og:image:height" content="121"><link rel="icon" type="image/png" href="http://www.sitecorn.be/images/fav.ico"><link href="http://www.sitecorn.be/images/sitecorn_large.png" rel="icon"><link rel="alternate" href="/atom.xml" title="Sitecorn" type="application/atom+xml"><link rel="stylesheet" href="/css/style.css" media="screen" type="text/css"><link rel="stylesheet" href="/css/custom.css" media="screen" type="text/css"><script>!function(e,a,t,n,c,o,s){e.GoogleAnalyticsObject=c,e[c]=e[c]||function(){(e[c].q=e[c].q||[]).push(arguments)},e[c].l=1*new Date,o=a.createElement(t),s=a.getElementsByTagName(t)[0],o.async=1,o.src=n,s.parentNode.insertBefore(o,s)}(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create","UA-76954315-1","auto"),ga("send","pageview")</script></head></html><body><header id="header" class="inner"><div class="alignleft"><h1><a href="/">Sitecorn</a></h1><h2><a href="/">offering a few kernels of knowledge</a></h2></div><nav id="main-nav" class="alignright"><ul><li><a href="/">Home</a></li><li><a href="/archives">Archives</a></li><li><a href="/about">About</a></li></ul><div class="clearfix"></div></nav><div class="clearfix"></div></header><div id="content" class="inner"><div id="main-col" class="alignleft"><div id="wrapper"><h2 class="archive-title">2016</h2><div class="archive"><article class="post"><div class="post-content"><header><div class="icon"></div><time datetime="2016-07-28T12:54:43.298Z"><a href="/2016/07/28/add-a-country-to-existing-ucommerce-catalog/">2016-07-28</a></time><h1 class="title"><a href="/2016/07/28/add-a-country-to-existing-ucommerce-catalog/">adding a country to existing uCommerce catalog</a></h1></header><div class="entry"><p>After creating two different catalogs for two different countries (US and Italy) in our uCommerce solution, I needed to add another country. This time however the Italy store and catalog are changed (manually) into an <a href="https://en.wikipedia.org/wiki/Europe,_the_Middle_East_and_Africa" target="_blank" rel="external">EMEA</a> store. Therefore the new country is added to this EMEA store, in my case, using the same payment method and currency.</p><p>Basically you can use the stored procedure for creating a <a href="http://sitecorn.be/2016/07/08/duplicate-UCommerce-Store/" target="_blank" rel="external">new store</a> and remove the things you do not need. You will need to change the parameters somewhat to link the new country to the payment method (and perhaps other relations).</p><p>Here’s the stored procedure that let’s you do that.</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> ANSI_NULLS <span class="keyword">ON</span></span><br><span class="line"><span class="keyword">GO</span></span><br><span class="line"><span class="keyword">SET</span> QUOTED_IDENTIFIER <span class="keyword">ON</span></span><br><span class="line"><span class="keyword">GO</span></span><br><span class="line"><span class="comment">-- =============================================</span></span><br><span class="line"><span class="comment">-- Author: Ruben Verschueren</span></span><br><span class="line"><span class="comment">-- Create date: 2016/07/28</span></span><br><span class="line"><span class="comment">-- Description:	creates a new uCommerce country store </span></span><br><span class="line"><span class="comment">-- and adds it to an existing store</span></span><br><span class="line"><span class="comment">-- =============================================</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> AddCountryToStore	</span><br><span class="line">@createdBy <span class="keyword">nvarchar</span>(<span class="number">20</span>),</span><br><span class="line">@currencyIsoCode <span class="keyword">nvarchar</span>(<span class="number">4</span>),</span><br><span class="line">@currenctExchangeRate <span class="built_in">int</span>,</span><br><span class="line">@countryName <span class="keyword">nvarchar</span>(<span class="number">25</span>),</span><br><span class="line">@vatRate <span class="built_in">decimal</span>(<span class="number">5</span>,<span class="number">2</span>),</span><br><span class="line">@priceGroupDescription <span class="keyword">nvarchar</span>(<span class="number">250</span>),</span><br><span class="line">@cultureCode <span class="keyword">nvarchar</span>(<span class="number">6</span>),	</span><br><span class="line">@paymentMethodId <span class="built_in">int</span>,</span><br><span class="line">@feePercent  <span class="built_in">decimal</span>(<span class="number">18</span>,<span class="number">4</span>),</span><br><span class="line">@shippingMethodName <span class="keyword">nvarchar</span>(<span class="number">128</span>),</span><br><span class="line">@productCatalogId <span class="built_in">int</span></span><br><span class="line"><span class="keyword">AS</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line"><span class="keyword">SET</span> NOCOUNT <span class="keyword">ON</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">DECLARE</span> @currencyId <span class="built_in">int</span></span><br><span class="line"><span class="keyword">DECLARE</span> @pricegroupId <span class="built_in">int</span></span><br><span class="line"><span class="keyword">DECLARE</span> @countryId <span class="built_in">int</span></span><br><span class="line"><span class="keyword">DECLARE</span> @shippingMethodId <span class="built_in">int</span>	</span><br><span class="line"><span class="keyword">DECLARE</span> @definitionTypeId <span class="built_in">int</span></span><br><span class="line"><span class="keyword">DECLARE</span> @emailProfileId <span class="built_in">int</span></span><br><span class="line"><span class="keyword">DECLARE</span> @orderNumberId <span class="built_in">int</span></span><br><span class="line"><span class="keyword">DECLARE</span> @productCatalogGroupId <span class="built_in">int</span></span><br><span class="line"><span class="keyword">DECLARE</span> @ProductCatalogPriceGroupRelationId <span class="built_in">int</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> @definitionTypeId = definitionTypeId </span><br><span class="line"><span class="keyword">FROM</span> uCommerce_DefinitionType </span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">name</span> = <span class="string">'PaymentMethod'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> @emailProfileId = emailprofileid </span><br><span class="line"><span class="keyword">FROM</span> uCommerce_EmailProfile </span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">name</span> =<span class="string">'Default'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> @orderNumberId = ordernumberid </span><br><span class="line"><span class="keyword">FROM</span> uCommerce_OrderNumberSerie </span><br><span class="line"><span class="keyword">WHERE</span> OrderNumberName = <span class="string">'Default'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- create currency</span></span><br><span class="line"><span class="keyword">SELECT</span> @currencyId = currencyid </span><br><span class="line"><span class="keyword">FROM</span> uCommerce_Currency </span><br><span class="line"><span class="keyword">WHERE</span> isocode = @currencyIsoCode <span class="keyword">AND</span> deleted = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">IF</span> (@currencyId <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">null</span>)</span><br><span class="line">	<span class="keyword">BEGIN</span></span><br><span class="line">		PRINT <span class="string">'currency already exists'</span>	</span><br><span class="line">	<span class="keyword">END</span></span><br><span class="line"><span class="keyword">ELSE</span></span><br><span class="line">	<span class="keyword">BEGIN</span></span><br><span class="line">	<span class="keyword">INSERT</span> uCommerce_Currency(isocode,exchangerate,deleted,guid) </span><br><span class="line">	<span class="keyword">VALUES</span> (@currencyIsoCode, @currenctExchangeRate, <span class="number">0</span>, NEWID())</span><br><span class="line">	<span class="keyword">SELECT</span> @currencyId =  SCOPE_IDENTITY()</span><br><span class="line">	<span class="keyword">END</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- create  pricegroup	</span></span><br><span class="line"><span class="keyword">SELECT</span> @pricegroupId = pricegroupid </span><br><span class="line"><span class="keyword">FROM</span> uCommerce_PriceGroup </span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">name</span> = @countryName <span class="keyword">AND</span> currencyId = @currencyId</span><br><span class="line"></span><br><span class="line"><span class="keyword">IF</span> (@pricegroupId <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">null</span>)</span><br><span class="line">	<span class="keyword">BEGIN</span></span><br><span class="line">	PRINT <span class="string">'pricegroup already exists'</span>	</span><br><span class="line">	<span class="keyword">UPDATE</span> uCommerce_PriceGroup </span><br><span class="line">	<span class="keyword">SET</span> deleted = <span class="number">0</span> <span class="keyword">WHERE</span> <span class="keyword">name</span> = @countryName <span class="keyword">AND</span> currencyId = @currencyId</span><br><span class="line">	<span class="keyword">END</span></span><br><span class="line"><span class="keyword">ELSE</span></span><br><span class="line">	<span class="keyword">BEGIN</span></span><br><span class="line">	<span class="keyword">INSERT</span> uCommerce_PriceGroup(<span class="keyword">name</span>,currencyid,vatrate,description,</span><br><span class="line">		createdon,createdby,modifiedon,modifiedby,deleted,guid)</span><br><span class="line">	<span class="keyword">VALUES</span> (@countryName ,@currencyId,@vatRate, @priceGroupDescription,<span class="keyword">getdate</span>(),</span><br><span class="line">		@createdBy,<span class="keyword">getdate</span>(),@createdBy,<span class="number">0</span>,NEWID())</span><br><span class="line">	<span class="keyword">SELECT</span> @pricegroupId = SCOPE_IDENTITY()</span><br><span class="line">	<span class="keyword">END</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- create country</span></span><br><span class="line"><span class="keyword">SELECT</span> @countryId = countryid </span><br><span class="line"><span class="keyword">FROM</span> uCommerce_Country </span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">name</span> = @countryName <span class="keyword">AND</span> Culture = @cultureCode</span><br><span class="line"><span class="keyword">IF</span> (@countryId <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">null</span>)</span><br><span class="line">	<span class="keyword">BEGIN</span></span><br><span class="line">	PRINT <span class="string">'country already exists'</span></span><br><span class="line">	<span class="keyword">UPDATE</span> uCommerce_Country </span><br><span class="line">	<span class="keyword">SET</span> deleted = <span class="number">0</span></span><br><span class="line">	<span class="keyword">WHERE</span> <span class="keyword">name</span> = @countryName</span><br><span class="line">	<span class="keyword">AND</span> Culture = @cultureCode</span><br><span class="line">	<span class="keyword">END</span></span><br><span class="line"><span class="keyword">ELSE</span></span><br><span class="line">	<span class="keyword">BEGIN</span></span><br><span class="line">	<span class="keyword">INSERT</span> uCommerce_Country(<span class="keyword">name</span>,culture,deleted) </span><br><span class="line">	<span class="keyword">VALUES</span> (@countryName, @cultureCode, <span class="number">0</span>)</span><br><span class="line">	<span class="keyword">SELECT</span> @countryId =  SCOPE_IDENTITY()</span><br><span class="line">	<span class="keyword">END</span> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">-- needed?</span></span><br><span class="line"><span class="keyword">SELECT</span> @shippingMethodId = ShippingMethodId </span><br><span class="line"><span class="keyword">FROM</span> uCommerce_ShippingMethod </span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">name</span> = @shippingMethodName <span class="keyword">AND</span> paymentmethodId = @paymentMethodId</span><br><span class="line"><span class="keyword">IF</span> (@shippingMethodId <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">null</span>)</span><br><span class="line">	<span class="keyword">BEGIN</span></span><br><span class="line">	PRINT <span class="string">'shipping method already exists'</span></span><br><span class="line">	<span class="keyword">END</span></span><br><span class="line"><span class="keyword">ELSE</span></span><br><span class="line">	<span class="keyword">BEGIN</span></span><br><span class="line">	<span class="keyword">INSERT</span> uCommerce_ShippingMethod(<span class="keyword">name</span>,PaymentMethodId,ServiceName,deleted) </span><br><span class="line">	<span class="keyword">VALUES</span> (@shippingMethodName, @paymentMethodId, <span class="string">'SinglePriceService'</span>, <span class="number">0</span>)</span><br><span class="line">	<span class="keyword">SELECT</span> @shippingMethodId =  SCOPE_IDENTITY()</span><br><span class="line">	<span class="keyword">END</span> </span><br><span class="line"></span><br><span class="line"><span class="comment">--map shipping method to country</span></span><br><span class="line"><span class="keyword">IF</span>((<span class="keyword">SELECT</span> <span class="keyword">count</span>(*) </span><br><span class="line"><span class="keyword">FROM</span> uCommerce_ShippingMethodCountry </span><br><span class="line"><span class="keyword">WHERE</span> CountryId = @countryId <span class="keyword">and</span> shippingMethodId = @shippingMethodId) = <span class="number">0</span>)</span><br><span class="line"><span class="keyword">BEGIN</span> </span><br><span class="line"><span class="keyword">INSERT</span> uCommerce_ShippingMethodCountry(CountryId,shippingMethodId)</span><br><span class="line"><span class="keyword">VALUES</span>(@CountryId,@shippingMethodId)</span><br><span class="line"><span class="keyword">END</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- create ProductCatalog pricegroup relation</span></span><br><span class="line"><span class="keyword">SELECT</span> @ProductCatalogPriceGroupRelationId = ProductCatalogPriceGroupRelationId </span><br><span class="line"><span class="keyword">FROM</span> uCommerce_ProductCatalogPriceGroupRelation</span><br><span class="line"><span class="keyword">WHERE</span> ProductCatalogId = @productCatalogId <span class="keyword">and</span> PriceGroupId = @pricegroupId</span><br><span class="line"><span class="keyword">IF</span> (@ProductCatalogPriceGroupRelationId <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">null</span>)</span><br><span class="line">	<span class="keyword">BEGIN</span></span><br><span class="line">	PRINT <span class="string">'ProductCatalog is already linked to pricegroup'</span></span><br><span class="line">	<span class="keyword">END</span></span><br><span class="line"><span class="keyword">ELSE</span></span><br><span class="line">	<span class="keyword">BEGIN</span></span><br><span class="line">	<span class="keyword">INSERT</span> uCommerce_ProductCatalogPriceGroupRelation</span><br><span class="line">	(productcatalogid,PriceGroupId,SortOrder) </span><br><span class="line">	<span class="keyword">VALUES</span> (@productCatalogId,@priceGroupId,<span class="number">0</span>)</span><br><span class="line">	<span class="keyword">SELECT</span> @ProductCatalogPriceGroupRelationId =  SCOPE_IDENTITY()</span><br><span class="line">	<span class="keyword">END</span></span><br><span class="line"><span class="keyword">END</span></span><br></pre></td></tr></table></figure><p>Now that we created the stored procedure, we can execute it as many times as we want adding more countries to our store. Obviously you need to change the values of the parameters especially the PaymentMethodId and productCatalogId. In the uCommerce backend you will now see the new country, pricegroup etc. If you open up the catalog, you will now see the new country as an option in the allowed priceGroups. Just enable the checkbox and you’re good to go… after you add all the prices on the products that is.</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">EXEC AddCountryToStore </span><br><span class="line">'Ruben'	<span class="comment">--createdBy</span></span><br><span class="line">,'EUR'	<span class="comment">--CurrencyIsoCode</span></span><br><span class="line">,100	<span class="comment">--currentExchangeRate</span></span><br><span class="line">,'Netherlands'			<span class="comment">--countryName</span></span><br><span class="line">,0.21				<span class="comment">--vatRate</span></span><br><span class="line">,'Pricing for NL eCommerce'	<span class="comment">--priceGroupDescription</span></span><br><span class="line">,'nl-NL'			<span class="comment">--cultureCode</span></span><br><span class="line">,8				<span class="comment">--PaymentMethodId</span></span><br><span class="line">,0.0000			<span class="comment">--feePerentage</span></span><br><span class="line">,'MyShippingMethod'	<span class="comment">--shippingmethodName</span></span><br><span class="line">,5			<span class="comment">--productCatalogId</span></span><br></pre></td></tr></table></figure></div></div></article><article class="post"><div class="post-content"><header><div class="icon"></div><time datetime="2016-07-26T11:45:09.868Z"><a href="/2016/07/26/markdown-to-blog-and-documents/">2016-07-26</a></time><h1 class="title"><a href="/2016/07/26/markdown-to-blog-and-documents/">markdown to blog and documents</a></h1></header><div class="entry"><p>Recently I started using markdown files as a quick way to write documentation on projects. At first I didn’t bother converting the files as there is at least one <a href="https://chrome.google.com/webstore/detail/markdown-preview-plus/febilkbfcbhebfnokafefeacimjdckgl?utm_source=chrome-app-launcher-info-dialog" target="_blank" rel="external">plug in</a> in chrome that can render them as HTML. In Visual studio I just used the <a href="https://visualstudiogallery.msdn.microsoft.com/0855e23e-4c4c-4c82-8b39-24ab5c5a7f79" target="_blank" rel="external">Markdown Mode</a> extension to work with.</p><p>Then I thought of starting a (static) blog and since I already had markdown files, I was in the market for a static site generator. After trying out several different generators I settled on <a href="https://hexo.io/" target="_blank" rel="external">Hexo</a> which works with simple command line instructions to create posts (in markdown) and generate a site from them.</p><p>I could then easily host this static site on github pages. Refer to the deployment page of the <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="external">Hexo documentation</a> on how to achieve that. There are a lot of blog posts out there on how to set this up as well if you need further assistance.</p><p>Now I still wanted to have these documents in my project folder as documentation, so I looked for a way to generate them without all the headers and navigation and such that I would have on the blog. I could a new theme or renderer to Hexo, but I found a better alternative called <a href="http://pandoc.org/installing.html" target="_blank" rel="external">Pandoc</a>. This lets me generate PDF files from markdown. So now I have one source document written in markdown and (at least) two different output formats.</p><p>There are still some issues I’m having, that I want to clear up. The first is a problem with image links Hexo seems to like a leading slash in the image URLs, while Pandoc only seems to work without. Now I haven’t spent much time on this, so there’s bound to be a solution for it.</p><p>The second issue is that now I have two different tools to render the output. It’s not a big problem but I would like to have them both in a single command or pipeline. At the moment this is how I do it. I’m using windows command line to navigate to the Hexo directory first.</p><p><strong>create a new post</strong></p><p>Using the statement below creates a new markdown document in the _posts folder of your Hexo folder structure.</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo <span class="keyword">new</span> post <span class="string">"Post Name"</span></span><br></pre></td></tr></table></figure><p><strong>generate my site</strong></p><p>This command generates the full site in the public folder.</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo generate</span><br></pre></td></tr></table></figure><p><strong>copy the generated site to a local IIS site</strong></p><p>As I want to verify that the site works (and also to have an offline copy), I have a local IIS site setup. This is in a different location so I can see what would be deployed.</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xcopy D:\SITE_PATH\<span class="keyword">public</span> D:\[IIS_SITE_PATH]\Sitecorn /e /d</span><br></pre></td></tr></table></figure><p><strong>Copy to a GIT repository</strong></p><p>For the moment I’m not using the hexo deploy feature. I have several GIT repositories set up for other projects so it makes sense to have this one in the same location. I commit and deploy this repository with the github desktop application, but there are many more tools out there you could use.</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xcopy D:\Projects\sitecorn\<span class="keyword">public</span> C:\Users\rubenv\Documents\GitHub\rubenVerschueren.github.io /e /d</span><br></pre></td></tr></table></figure><p><strong>Generate PDF documents</strong></p><p>This command loops through the markdown documents and uses Pandoc to generate the PDF files and puts them in the LOCATION folder.</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> /r %<span class="function">i <span class="title">in</span> (<span class="params">_posts<span class="comment">/*.md) do pandoc _posts/%~ni.md -o  LOCATION/%~ni.pdf</span></span></span></span><br></pre></td></tr></table></figure><p>Finally if you only need to generate a single file you can use the following command.</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pandoc source/_posts/my_document.md -o portal/my_document.pdf</span><br></pre></td></tr></table></figure></div></div></article><article class="post"><div class="post-content"><header><div class="icon"></div><time datetime="2016-07-08T14:48:36.254Z"><a href="/2016/07/08/modifying-sitecore-itemlinks/">2016-07-08</a></time><h1 class="title"><a href="/2016/07/08/modifying-sitecore-itemlinks/">modifying sitecore itemlinks</a></h1></header><div class="entry"><p>I recently had to modify an archive functionality in which you could archive an item or one of it’s children. If you archived child A then it’s parent would be cloned or copied (depending on the situation) to the archive and the child would be moved. But we also have other items that were referencing this item and it would also be possible to archive just one language version. I won’t go into the rather complex rules of the archiving command, but basically I needed to duplicate all references to the child item and link them to the archived item.</p><p>I poked around the web a bit and the <a href="http://www.sitecoreexperts.com/2014/09/bi-directional-one-to-many-and-many-to-many-relationships-in-sitecore/" target="_blank" rel="external">sitecore experts</a> blog sent me in the right direction.</p><p>I used their GetReferrers method to retrieve an IEnumerable of ItemLinks to the original item.</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> IEnumerable&lt;ItemLink&gt; <span class="title">GetReferrers</span>(<span class="params">Item item, ID sourceFieldId = <span class="keyword">null</span></span>)</span><br><span class="line"></span>&#123;</span><br><span class="line">    ItemLink[] referrers = sourceFieldId != <span class="keyword">null</span> <span class="keyword">as</span> ID</span><br><span class="line">    ? Globals.LinkDatabase.GetReferrers(item, sourceFieldId)</span><br><span class="line">    : Globals.LinkDatabase.GetReferrers(item);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> referrers;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>After that it is just a matter of looping through the item links and adding a new link to the source item. In case of unarchiving I needed the opposite method to delete some item links, so I added that as well.</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">AddLinks</span>(<span class="params">Item source, Item target</span>)</span><br><span class="line"></span>&#123;</span><br><span class="line">    IEnumerable&lt;ItemLink&gt; referencingItems = GetReferrers(source, Constants.FieldId1);</span><br><span class="line">    referencingItems.Union(GetReferrers(source, Constants.FieldId2));</span><br><span class="line">    List&lt;ItemLink&gt; links = referencingItems.ToList();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (links == <span class="keyword">null</span> || !links.Any())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">foreach</span> (ItemLink itemLink <span class="keyword">in</span> links)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (itemLink.SourceFieldID != Guid.Empty.ToID())</span><br><span class="line">        &#123;</span><br><span class="line">            Item linkSource = itemLink.GetSourceItem();</span><br><span class="line">            linkSource.Editing.BeginEdit();</span><br><span class="line">            <span class="keyword">string</span> fieldName = linkSource.Fields.FirstOrDefault(f =&gt; f.ID == itemLink.SourceFieldID).Name;</span><br><span class="line">            ((MultilistField)linkSource.Fields[fieldName]).Add(target.ID.ToString());</span><br><span class="line">            linkSource.Editing.AcceptChanges();</span><br><span class="line">            linkSource.Editing.EndEdit();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">DeleteLinks</span>(<span class="params">Item item</span>)</span><br><span class="line"></span>&#123;</span><br><span class="line">    IEnumerable&lt;ItemLink&gt; referencingItems = GetReferrers(item, Constants.FieldId1);</span><br><span class="line">    referencingItems.Union(GetReferrers(item, Constants.FieldId2));</span><br><span class="line">    List&lt;ItemLink&gt; links = referencingItems.ToList();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (links == <span class="keyword">null</span> || !links.Any())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">foreach</span> (ItemLink itemLink <span class="keyword">in</span> links)</span><br><span class="line">    &#123;</span><br><span class="line">        Item source = itemLink.GetSourceItem();</span><br><span class="line">        source.Editing.BeginEdit();</span><br><span class="line">        MultilistField field = source.Fields.FirstOrDefault(f =&gt; f.ID == itemLink.SourceFieldID);</span><br><span class="line">        <span class="keyword">if</span> (field.Contains(item.ID.ToString()))</span><br><span class="line">        &#123;</span><br><span class="line">            field.Remove(item.ID.ToString());</span><br><span class="line">        &#125;</span><br><span class="line">        source.Editing.AcceptChanges();</span><br><span class="line">        source.Editing.EndEdit();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Seeing as both these methods are almost identical, some refactoring is required. It turns out this pattern has a name, the “hole in the middle pattern”. I personally would have called it the donut (doughnut) pattern.</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">ModifyLinks</span>(<span class="params">Action&lt;MultilistField, Item&gt; action, Item sourceItem, Item targetItem = <span class="keyword">null</span></span>)</span><br><span class="line"></span>&#123;</span><br><span class="line">    IEnumerable&lt;ItemLink&gt; referencingItems = GetReferrers(sourceItem, IDownloadConstants.ProductsFieldId);</span><br><span class="line">    referencingItems.Union(GetReferrers(sourceItem, ISoftware_InformationConstants.ProductsFieldId));</span><br><span class="line">    List&lt;ItemLink&gt; links = referencingItems.ToList();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (links == <span class="keyword">null</span> || !links.Any())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">foreach</span> (ItemLink itemLink <span class="keyword">in</span> links)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (itemLink.SourceFieldID != Guid.Empty.ToID())</span><br><span class="line">        &#123;</span><br><span class="line">            Item source = itemLink.GetSourceItem();</span><br><span class="line">            source.Editing.BeginEdit();</span><br><span class="line">            MultilistField field = source.Fields.FirstOrDefault(f =&gt; f.ID == itemLink.SourceFieldID);</span><br><span class="line"></span><br><span class="line">            action(field, targetItem);</span><br><span class="line"></span><br><span class="line">            source.Editing.AcceptChanges();</span><br><span class="line">            source.Editing.EndEdit();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Delete links like in the following snippet, where you pass the source item twice.</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ModifyLinks((field, target) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (field.Contains(target.ID.ToString()))</span><br><span class="line">    &#123;</span><br><span class="line">        field.Remove(target.ID.ToString());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;, item, item);</span><br></pre></td></tr></table></figure><p>Add links in a similar fashion by passing in the source item and the target item. The first being the one you want to copy the links from and the latter being the one you want a new link to.</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ModifyLinks((field, target) =&gt; &#123;field.Add(target.ID.ToString());&#125;, item, addedItem);</span><br></pre></td></tr></table></figure></div></div></article></div></div></div><aside id="sidebar" class="alignright"><a href="https://twitter.com/RubenVerschuern" class="twitter-follow-button" data-show-count="false" data-size="large">Follow @RubenVerschuern</a><script>!function(t,e,r){var n,s=t.getElementsByTagName(e)[0],i=/^http:/.test(t.location)?"http":"https";t.getElementById(r)||(n=t.createElement(e),n.id=r,n.src=i+"://platform.twitter.com/widgets.js",s.parentNode.insertBefore(n,s))}(document,"script","twitter-wjs")</script><div class="widget tag"><h3 class="title">Tags</h3><ul class="entry"><li><a href="/tags/adyen-skin/">adyen skin</a><small>1</small></li><li><a href="/tags/autocomplete/">autocomplete</a><small>1</small></li><li><a href="/tags/blog/">blog</a><small>1</small></li><li><a href="/tags/browser-extensions/">browser extensions</a><small>1</small></li><li><a href="/tags/cheat-sheet/">cheat sheet</a><small>1</small></li><li><a href="/tags/extension-methods/">extension methods</a><small>1</small></li><li><a href="/tags/filter/">filter</a><small>1</small></li><li><a href="/tags/google-maps/">google maps</a><small>1</small></li><li><a href="/tags/hpp/">hpp</a><small>1</small></li><li><a href="/tags/itemlink/">itemlink</a><small>1</small></li><li><a href="/tags/javascript/">javascript</a><small>2</small></li><li><a href="/tags/markdown/">markdown</a><small>1</small></li><li><a href="/tags/mediarequest/">mediarequest</a><small>1</small></li><li><a href="/tags/multiple-renderings/">multiple renderings</a><small>1</small></li><li><a href="/tags/mvc/">mvc</a><small>1</small></li><li><a href="/tags/pdf/">pdf</a><small>1</small></li><li><a href="/tags/plugins/">plugins</a><small>1</small></li><li><a href="/tags/resharper/">resharper</a><small>1</small></li><li><a href="/tags/shortcut/">shortcut</a><small>1</small></li><li><a href="/tags/sitecore-8/">sitecore 8</a><small>4</small></li><li><a href="/tags/sql/">sql</a><small>3</small></li><li><a href="/tags/tools/">tools</a><small>1</small></li><li><a href="/tags/ucommerce/">ucommerce</a><small>3</small></li><li><a href="/tags/unit-testing/">unit testing</a><small>1</small></li><li><a href="/tags/visual-studio/">visual studio</a><small>1</small></li></ul></div></aside><div class="clearfix"></div></div><footer id="footer" class="inner"><div class="alignleft">&copy; 2016 Ruben Verschueren</div><div class="clearfix"></div></footer><script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script><script src="/js/jquery.imagesloaded.min.js"></script><script src="/js/gallery.js"></script><script type="text/javascript">var disqus_shortname="sitecorn";!function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="//"+disqus_shortname+".disqus.com/count.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)}()</script><link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css"><script src="/fancybox/jquery.fancybox.pack.js"></script><script type="text/javascript">!function(n){n(".fancybox").fancybox()}(jQuery)</script></body><!-- rebuild by neat -->