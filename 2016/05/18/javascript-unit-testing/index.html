<!-- build time:Thu Sep 08 2016 15:04:15 GMT+0200 (Romance Daylight Time) --><!DOCTYPE HTML><html><head><meta charset="utf-8"><title>Javascript unit testing with Qunit | Sitecorn</title><meta name="author" content="Ruben Verschueren"><meta name="description" content="web development tips &amp; tricks"><meta name="og:description" content="web development tips &amp; tricks"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta property="og:title" content="Javascript unit testing with Qunit"><meta property="og:site_name" content="Sitecorn"><meta property="og:url" content="http://www.sitecorn.be/2016/05/18/javascript-unit-testing/"><meta property="og:image" content="http://www.sitecorn.be/images/sitecorn_large.png"><meta property="og:image:width" content="100"><meta property="og:image:height" content="121"><link rel="icon" type="image/png" href="http://www.sitecorn.be/images/fav.ico"><link href="http://www.sitecorn.be/images/sitecorn_large.png" rel="icon"><link rel="alternate" href="/atom.xml" title="Sitecorn" type="application/atom+xml"><link rel="stylesheet" href="/css/style.css" media="screen" type="text/css"><link rel="stylesheet" href="/css/custom.css" media="screen" type="text/css"><script>!function(e,a,t,n,c,o,s){e.GoogleAnalyticsObject=c,e[c]=e[c]||function(){(e[c].q=e[c].q||[]).push(arguments)},e[c].l=1*new Date,o=a.createElement(t),s=a.getElementsByTagName(t)[0],o.async=1,o.src=n,s.parentNode.insertBefore(o,s)}(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create","UA-76954315-1","auto"),ga("send","pageview")</script></head></html><body><header id="header" class="inner"><div class="alignleft"><h1><a href="/">Sitecorn</a></h1><h2><a href="/">offering a few kernels of knowledge</a></h2></div><nav id="main-nav" class="alignright"><ul><li><a href="/">Home</a></li><li><a href="/archives">Archives</a></li><li><a href="/about">About</a></li></ul><div class="clearfix"></div></nav><div class="clearfix"></div></header><div id="content" class="inner"><div id="main-col" class="alignleft"><div id="wrapper"><article class="post"><div class="post-content"><header><div class="icon"></div><time datetime="2016-05-18T13:58:46.896Z"><a href="/2016/05/18/javascript-unit-testing/">2016-05-18</a></time><h1 class="title">Javascript unit testing with Qunit</h1></header><div class="entry"><p>Qunit is a javascript testing framework created by the jquery foundation. You can download Qunit and find some more documentation at <a href="http://qunitjs.com/" class="uri" target="_blank" rel="external">http://qunitjs.com/</a> . The site has tutorials and general unit testing info, so I won’t go into details but here is a quick recap to get started. Include qunit and your test.js in your header. Throw in the qunit CSS if you like the fancy red/green colors for your test results.</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;script src=<span class="string">"resources/qunit-1.13.0.js"</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;script src=<span class="string">"resources/tests.js"</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;link rel=<span class="string">"stylesheet"</span> href=<span class="string">"resources/qunit-1.13.0.css"</span>&gt;</span><br></pre></td></tr></table></figure><p>In your tests.js add the following code and presto! Your have some working tests.</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">test( <span class="string">"hello string test"</span>, function() &#123;</span><br><span class="line">ok( <span class="number">1</span> === <span class="string">"1"</span>, <span class="string">"Failed!"</span> );</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">test( <span class="string">"hello integer test"</span>, function() &#123;</span><br><span class="line">ok( <span class="number">1</span> === <span class="number">1</span>, <span class="string">"Passed!"</span> );</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>Here’s what that looks like in your browser:</p><div class="figure"><img src="/images/qunit.png" alt="Qunit basic setup"><p class="caption">Qunit basic setup</p></div><p>Now let’s add some extensions to Qunit. Link jQuery and the QunitExtensions.js in your header and you’ll get the following extra’s. You could get rid of the jquery, but you’ll have to rewrite some of the extension code. * Next to existing Test and AsyncTest, the extensions adds a SkippedTest. * A handy checkbox that will sort the test results by result type * A checkbox similar to the existing ones that lets you hide/show the SkippedTests * Setup module function which enables you to define setup and teardown functions for your tests.</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">function <span class="title">setupModule</span>(<span class="params">name, setupFunction, tearDownFunction</span>)</span>&#123;…&#125;</span><br></pre></td></tr></table></figure><p>For the statistics guys/gals I threw in the following code. Which outputs a Junit XML report to the console. The thought behind that is to prepare to dump this report in a CI environment. You’ll have to add the qunit-reporter-junit.js in your header as well.</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">QUnit.jUnitReport = function(report) &#123;</span><br><span class="line">console.log(report.xml);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>Here’s an example export:</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span>?&gt;</span><br><span class="line">&lt;testsuites name=<span class="string">"file:///D:/cloudstation/JS%20testing/testsuite.html"</span> </span><br><span class="line">hostname=<span class="string">"localhost"</span> tests=<span class="string">"2"</span> failures=<span class="string">"0"</span> errors=<span class="string">"0"</span> time=<span class="string">"0.053"</span> timestamp=<span class="string">"2014-11-06T10:40:37Z"</span>&gt;</span><br><span class="line">&lt;testsuite id=<span class="string">"0"</span> name=<span class="string">"Hello Qunit module"</span> hostname=<span class="string">"localhost"</span> tests=<span class="string">"2"</span> failures=<span class="string">"0"</span></span><br><span class="line"> errors=<span class="string">"0"</span> time=<span class="string">"0.001"</span> timestamp=<span class="string">"2014-11-06T10:40:37Z"</span>&gt;</span><br><span class="line">&lt;testcase name=<span class="string">"hello string test"</span> tests=<span class="string">"1"</span> failures=<span class="string">"0"</span> errors=<span class="string">"0"</span> time=<span class="string">"0"</span> timestamp=<span class="string">"2014-11-06T10:40:37Z"</span>&gt;</span><br><span class="line">&lt;/testcase&gt;</span><br><span class="line">&lt;testcase name=<span class="string">"hello integer test"</span> tests=<span class="string">"1"</span> failures=<span class="string">"0"</span> errors=<span class="string">"0"</span> time=<span class="string">"0"</span> timestamp=<span class="string">"2014-11-06T10:40:37Z"</span>&gt;</span><br><span class="line">&lt;/testcase&gt;</span><br><span class="line">&lt;/testsuite&gt;</span><br><span class="line">&lt;testsuite id=<span class="string">"1"</span> name=<span class="string">"skipped test module"</span> hostname=<span class="string">"localhost"</span> tests=<span class="string">"0"</span> failures=<span class="string">"0"</span></span><br><span class="line"> errors=<span class="string">"0"</span> time=<span class="string">"0.001"</span> timestamp=<span class="string">"2014-11-06T10:40:37Z"</span>&gt;</span><br><span class="line">&lt;testcase name=<span class="string">"Igore me (SKIPPED)"</span> tests=<span class="string">"0"</span> failures=<span class="string">"0"</span> errors=<span class="string">"0"</span> time=<span class="string">"0.001"</span> timestamp=<span class="string">"2014-11-06T10:40:37Z"</span>&gt;</span><br><span class="line">&lt;/testcase&gt;</span><br><span class="line">&lt;/testsuite&gt;</span><br><span class="line">&lt;/testsuites&gt;</span><br></pre></td></tr></table></figure><p>Here’s what the skipped test looks like in code and browser:</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SkippedTest(<span class="string">'Igore me'</span>,function()&#123;</span><br><span class="line">equal(<span class="string">'foo'</span>,<span class="string">'bar'</span>, <span class="string">'this never happened'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><div class="figure"><img src="/images/qunit2.png" alt="Qunit skipped test"><p class="caption">Qunit skipped test</p></div><p>Now let’s divide these tests into modules without any setup and teardown functions:</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">setupModule(<span class="string">"Hello Qunit module"</span>, <span class="keyword">null</span>, <span class="keyword">null</span>);</span><br><span class="line"></span><br><span class="line">test( <span class="string">"hello string test"</span>, function() &#123;</span><br><span class="line">ok( <span class="string">"1"</span> === <span class="string">"1"</span>, <span class="string">"Failed!"</span> );</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">test( <span class="string">"hello integer test"</span>, function() &#123;</span><br><span class="line">ok( <span class="number">1</span> === <span class="number">1</span>, <span class="string">"Passed!"</span> );</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">setupModule(<span class="string">"skipped test module"</span>, <span class="keyword">null</span>, <span class="keyword">null</span>);</span><br><span class="line">SkippedTest(<span class="string">'Igore me'</span>,function()&#123;</span><br><span class="line">equal(<span class="string">'foo'</span>,<span class="string">'bar'</span>, <span class="string">'this never happened'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>Notice that the results display the name of the module they belong to, but more practical is the dropdown at the top allowing you to select a module. This will execute only the tests in that module. At some point you may want to have some benchmarks on your script (functional script, not the tests themselves). So lets do that now. Don’t forget to add references to lodash-compat.js and benchmark.js . Just so we have something to test, I added the RandomIntFromInterval and GenerateCode functions (guess what they do..). In the tests. js file I added a formatOutput function to display the results of the benchmark.</p><p>And this code snippet which creates the benchmark suite and adds the two functions to it:</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> suite = <span class="keyword">new</span> Benchmark.Suite;</span><br><span class="line"></span><br><span class="line"><span class="comment">// add tests</span></span><br><span class="line">suite.add(<span class="string">'RandomIntFromInterval_benchmark#test'</span>, function() &#123;</span><br><span class="line"><span class="keyword">var</span> Number = RandomIntFromInterval(<span class="number">1</span>, <span class="number">10</span>);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">.add(<span class="string">'GenerateCode_benchmark#test'</span>, function() &#123;</span><br><span class="line"><span class="keyword">var</span> ColorsEnum = [<span class="string">"yellow"</span>, <span class="string">"green"</span>, <span class="string">"orange"</span>,<span class="string">"purple"</span>,<span class="string">"gray"</span>,<span class="string">"magenta"</span>,<span class="string">"red"</span>,<span class="string">"white"</span>,<span class="string">"black"</span>];</span><br><span class="line"><span class="keyword">var</span> mastercode = GenerateCode(ColorsEnum);</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// add listeners</span></span><br><span class="line">.on(<span class="string">'cycle'</span>, function(<span class="keyword">event</span>) &#123;</span><br><span class="line"><span class="comment">//console.log(String(event.target));</span></span><br><span class="line">$(<span class="string">"&lt;div&gt;"</span>+formatOutput(String(<span class="keyword">event</span>.target))+<span class="string">"&lt;/div&gt;"</span>).appendTo(<span class="string">"#benchmarks"</span>);</span><br><span class="line">&#125;)</span><br><span class="line">.on(<span class="string">'complete'</span>, function() &#123;</span><br><span class="line">console.log(<span class="string">'Fastest is '</span> + <span class="keyword">this</span>.filter(<span class="string">'fastest'</span>).pluck(<span class="string">'name'</span>));</span><br><span class="line">&#125;)</span><br><span class="line">.on(<span class="string">'start'</span>,function()&#123;</span><br><span class="line"><span class="comment">// do something when the suite starts</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// run async</span></span><br><span class="line">.run(&#123; <span class="string">'async'</span>: <span class="keyword">true</span> &#125;);</span><br></pre></td></tr></table></figure><p>This will result in the super helpful results below (notice the pretty layout I added to make it match the Qunit results). I’d advise to wrap the benchmark code in a conditional statement so you can toggle them on or off. You can even go so far as to add another checkbox to control that.</p><div class="figure"><img src="/images/qunit3.png" alt="Qunit benchmark"><p class="caption">Qunit benchmark</p></div><p>But what about quality you ask. Well let’s add a quality check with jsHint and Qhint (which is just a layer over jsHint). Link to the correct files in the head of the page. And add the following test to your tests.js file (demo.js contains the functions of previous steps):</p><ul><li>qHint(“QHint code quality:”, “resources/demo.js”); Since we did such a fine job in coding those functions I get an “Okay” from jsHint.</li></ul><div class="figure"><img src="/images/qunit4.png" alt="JShint"><p class="caption">JShint</p></div><p>Now you might get an error like this:</p><div class="figure"><img src="/images/qunit5.png" alt="JShint error"><p class="caption">JShint error</p></div><p>Which means you aren’t running the testsuite file from a server (IIS, or WAMP or anything like it). If the URL in your address bar starts with “file:///”, you’ll get punished with a broken test. So again I’d advise to put a condition around it, to ignore this test in case want to run the testsuite outside of a server environment.</p><p>Finally if you are really really serious about testing, you can run a code coverage test with JS-Coverage. A project called JSCover is being built on top of this, which checks even more metrics. Running JS-coverage involves executing and exe with some parameters, so I’ll refer to their manual instead of repeating it here: [link](http://siliconforks.com/jscoverage/manual.html](http://siliconforks.com/jscoverage/manual.html) .</p><p>Basically it takes your files and inserts instrumenting javascript in them and drops everything in a new directory. In this directory you’ll find a jscoverage.html. <strong>IMPORTANT</strong> just like jsHint you’ll need to run this file on a server. Once you open that, you’ll see a (very ugly) screen like this:</p><div class="figure"><img src="/images/qunit6.png" title="JS coverage" alt="JS coverage"><p class="caption">JS coverage</p></div><p>Here I already entered the url to the testsuite.html file.</p><p>IMPORTANT this should be the file inside the newly generated js-coverage directory as this is the one containing the instrumentation code.</p><p>If you click on the summary tab you’ll see something similar to this:</p><div class="figure"><img src="/images/qunit7.png" title="JS coverage summary" alt="JS coverage summary"><p class="caption">JS coverage summary</p></div><p>If you click on one of the files you’ll open up the source tab with some extra info:</p><div class="figure"><img src="/images/qunit8.png" title="JS coverage source" alt="JS coverage source"><p class="caption">JS coverage source</p></div><p>That concludes this tutorial. I’ll include a zip-file which contains the code of this tutorial.</p><p>As a bonus I’ll add a second zip file containing a simple mastermind game, made TDD style with all these tool. You can find the tests in /js/testsuite.html I already generated the instrumented code which can be found in mastermind/jscoverage_src .</p><div class="figure"><img src="/images/qunit9.png" title="Mastermind screenshot" alt="Mastermind screenshot"><p class="caption">Mastermind screenshot</p></div><p>The idea behind making that mastermind game, besides the fact that it is fun, is to make a series of these tutorials. Next step will be some better layout and useabilty (yes, I’m talking about a fancy color picker and all that) and javascript templating with mustache.</p><p>List of links for more information:</p><ul><li>[QHint] (https://github.com/gyoshev/qhint)</li><li>[JSHint] (http://www.jshint.com/)</li><li>[Benchmark] (http://benchmarkjs.com/)</li><li>[QUnit] (http://qunitjs.com/)</li><li>[JS-Coverage] (http://siliconforks.com/jscoverage/)</li></ul><p>Zip files with all code for this tutorial:</p><ul><li><a href="/2016/05/18/javascript-unit-testing/mastermind.zip" title="mastermind zip file">mastermind zip file</a></li><li><a href="/2016/05/18/javascript-unit-testing/testsuite.zip" title="test suite zip file">test suite zip file</a></li></ul></div><footer><div class="tags"><a href="/tags/javascript/">javascript</a>, <a href="/tags/unit-testing/">unit testing</a></div><div class="addthis addthis_toolbox addthis_default_style"><a class="addthis_button_facebook_like" fb:like:layout="button_count"></a> <a class="addthis_button_tweet"></a> <a class="addthis_button_google_plusone" g:plusone:size="medium"></a> <a class="addthis_counter addthis_pill_style"></a></div><script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js"></script><div class="clearfix"></div></footer></div></article><section id="comment"><h1 class="title">Comments</h1><div id="disqus_thread"><noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div></section></div></div><aside id="sidebar" class="alignright"><a href="https://twitter.com/RubenVerschuern" class="twitter-follow-button" data-show-count="false" data-size="large">Follow @RubenVerschuern</a><script>!function(t,e,r){var n,s=t.getElementsByTagName(e)[0],i=/^http:/.test(t.location)?"http":"https";t.getElementById(r)||(n=t.createElement(e),n.id=r,n.src=i+"://platform.twitter.com/widgets.js",s.parentNode.insertBefore(n,s))}(document,"script","twitter-wjs")</script><div class="widget tag"><h3 class="title">Tags</h3><ul class="entry"><li><a href="/tags/adyen-skin/">adyen skin</a><small>1</small></li><li><a href="/tags/autocomplete/">autocomplete</a><small>1</small></li><li><a href="/tags/blog/">blog</a><small>1</small></li><li><a href="/tags/browser-extensions/">browser extensions</a><small>1</small></li><li><a href="/tags/cheat-sheet/">cheat sheet</a><small>1</small></li><li><a href="/tags/extension-methods/">extension methods</a><small>1</small></li><li><a href="/tags/filter/">filter</a><small>1</small></li><li><a href="/tags/google-maps/">google maps</a><small>1</small></li><li><a href="/tags/hpp/">hpp</a><small>1</small></li><li><a href="/tags/itemlink/">itemlink</a><small>1</small></li><li><a href="/tags/javascript/">javascript</a><small>2</small></li><li><a href="/tags/markdown/">markdown</a><small>1</small></li><li><a href="/tags/mediarequest/">mediarequest</a><small>1</small></li><li><a href="/tags/multiple-renderings/">multiple renderings</a><small>1</small></li><li><a href="/tags/mvc/">mvc</a><small>1</small></li><li><a href="/tags/pdf/">pdf</a><small>1</small></li><li><a href="/tags/plugins/">plugins</a><small>1</small></li><li><a href="/tags/resharper/">resharper</a><small>1</small></li><li><a href="/tags/shortcut/">shortcut</a><small>1</small></li><li><a href="/tags/sitecore-8/">sitecore 8</a><small>4</small></li><li><a href="/tags/sql/">sql</a><small>3</small></li><li><a href="/tags/tools/">tools</a><small>1</small></li><li><a href="/tags/ucommerce/">ucommerce</a><small>3</small></li><li><a href="/tags/unit-testing/">unit testing</a><small>1</small></li><li><a href="/tags/visual-studio/">visual studio</a><small>1</small></li></ul></div></aside><div class="clearfix"></div></div><footer id="footer" class="inner"><div class="alignleft">&copy; 2016 Ruben Verschueren</div><div class="clearfix"></div></footer><script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script><script src="/js/jquery.imagesloaded.min.js"></script><script src="/js/gallery.js"></script><script type="text/javascript">var disqus_shortname="sitecorn";!function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="//"+disqus_shortname+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)}()</script><link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css"><script src="/fancybox/jquery.fancybox.pack.js"></script><script type="text/javascript">!function(n){n(".fancybox").fancybox()}(jQuery)</script></body><!-- rebuild by neat -->